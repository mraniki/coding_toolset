
name: ðŸ¦ºLint

on:
  # push:
  #   branches: ["main","dev"]
  # pull_request:
  # workflow_dispatch:
  # schedule:
  #   - cron: '42 23 * * 5'
  #!contains(github.event.head_commit.message, 'fix|ðŸŽ¨|:art:|ðŸ›|:bug:|ðŸš‘|:ambulance:|âš¡|:zap:|ðŸ”¥|:fire:|ðŸš¨|:rotating_light:|â™»ï¸|:recycle:|ðŸ”§|:wrench:|â¬†ï¸|:arrow_up:|ðŸ©¹|:adhesive_bandage:|ðŸ‘·|:construction_worker:|:construction_worker_man:|ðŸ“|:memo:|ðŸ”’|:lock:|ðŸ‘½|:alien:|ðŸ’¬|:speech_balloon:|ðŸ¥…|:goal_net:|âœ…|:white_check_mark:|ðŸ³|:whale:|ðŸ™ˆ|:see_no_evil:|âš—ï¸|:alembic:|ðŸ§|:monocle_face:|ðŸ”‡|:mute:|ðŸ”Š|:loud:|feat|ðŸ¥š|:egg:|ðŸš€|:rocket:|ðŸ’„|:lipstick:|âœ¨|:sparkles:|BREAKING|ðŸ’¥|:boom:|Merge|Update|Refactored|Initial commit')

  workflow_call:

jobs:

  coding-standards:
    name: Linting & CodingStandards
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v3.5.3

      - name: Lint Code Base
        uses: github/super-linter@v5
        env:
          VALIDATE_ALL_CODEBASE: false
          DEFAULT_BRANCH: main
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VALIDATE_MARKDOWN: false
          VALIDATE_PYTHON_MYPY: false
          VALIDATE_PYTHON_FLAKE8: false
          VALIDATE_PYTHON_BLACK: false
          VALIDATE_PYTHON_ISORT: false

  semantic-check:
    name: CommitLint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Check commit message
        env:
          COMMITS_URL: ${{ github.event.pull_request.commits_url }}
        run: |
          if [ "${COMMITS_URL}x" != "x" ]; then
            # get commits list and pick up last one by jq
            # caution: only 100 commits will be taken by curl
            # if your PR has more than 100 commits
            # you have to set page query parameter
            # and request last page commits
            # API URL details: https://docs.github.com/en/rest/pulls/pulls?apiVersion=2022-11-28#list-commits-on-a-pull-request
            LAST_MSG=$(curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" "${COMMITS_URL}?per_page=100" | jq -r .[-1].commit.message)
            # set environment variable
            echo "LAST_MSG=${LAST_MSG}" >> "${GITHUB_ENV}"
          else
            echo 'LAST_MSG=' >> "${GITHUB_ENV}"
          fi
          # if !startsWith("$text", 'âœ…')
          #   echo "::warning:: Naming convention issues detected"
          #   echo "workflow head commit: ${{ github.event.workflow_run.head_commit.message }}"
          #   echo "event head commit: ${{ github.event.head_commit.message }}"
          #   echo "event head commit: github.event.head_commit.message"