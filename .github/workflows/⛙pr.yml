
name: â›™pr


on:
  workflow_dispatch:
  workflow_call:

jobs:

    create_pull_request:
      name: ğŸ›… Create GitHub PR
      runs-on: ubuntu-latest
      concurrency: release
      permissions:
        id-token: write
        contents: write
        pull-requests: write
      steps:
        - name: ğŸ”’ï¸ Install 1Password CLI
          uses: 1password/install-cli-action@v1
    
        - name: ğŸ”’ï¸ Load credentials
          uses: 1password/load-secrets-action@v1
          id: secrets
          with:
            export-env: false
          env:
            OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.OP_SERVICE_ACCOUNT_TOKEN }}
            TOKEN: "op://git/GITHUB/TOKEN"
      
        - name: ğŸ“¥ Checkout the repository
          uses: actions/checkout@v4
          with:
            fetch-depth: 0
            ref: dev
            token: ${{ steps.secrets.outputs.TOKEN }}

        - name: ğŸªª Identify
          if: github.event_name == 'pull_request'
          run: |
            git config --global user.email "action@github.com"
            git config --global user.name "${GITHUB_ACTOR}"

        - name: ğŸ›‚ Check Diff
          id: diff
          run: |
            if git diff origin/dev origin/main >/dev/null; then
              echo "CHANGE=TRUE" >> $GITHUB_OUTPUT
            else
              echo "CHANGE=FALSE" >> $GITHUB_OUTPUT
            fi

        - name: ğŸ”® Get a random quote
          id: quote
          run: |
            TITLE=$(fortune -s)
            echo "$TITLE" >> $GITHUB_OUTPUT

        - name: ğŸ›… Create pull request
          if: ${{ steps.diff.outputs.CHANGE }} == "TRUE"
          env:
            GH_TOKEN: ${{ steps.secrets.outputs.TOKEN }}
          id: cpr
          run: |
            
            gh pr create --title "â¬†ï¸ ğŸ¤– - ${{ steps.quote.outputs.TITLE }}" \
                         --base "main" \
                         --head "dev" \
                         --body "Auto Release"
