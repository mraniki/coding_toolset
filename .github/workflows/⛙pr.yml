
name: â›™pr


on:
  workflow_dispatch:
  workflow_call:
    inputs:
      settings_token:
        required: false
        type: string
        default: '.'

jobs:
    create_pull_request:
      name: 'Create PR'
      runs-on: ubuntu-latest
      permissions:
        pull-requests: write
      steps:
        - name: Install 1Password CLI
          uses: 1password/install-cli-action@v1

        - name: Load credentials
          uses: 1password/load-secrets-action@v1
          id: op-load-secrets
          with:
            export-env: false
          env:
            OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.OP_SERVICE_ACCOUNT_TOKEN }}
            TOKEN: "op://git/GITHUB/TOKEN"

        - uses: actions/checkout@v4
          with:
            fetch-depth: 0
            token: ${{ steps.op-load-secrets.outputs.TOKEN }}
      
        - name: Create Pull Request
          id: cpr
          uses: peter-evans/create-pull-request@v5
          with:
            token: ${{ steps.op-load-secrets.outputs.TOKEN }}
            branch: ${{ github.repository }}-dev
            base: main
            delete-branch: false
            commit-message: "[${{ github.repository }}]: Automated deploy for ${{ github.sha }}"
            title: "Update ${{ github.repository }} to ${{ github.sha }}"
            body: |
              PR Automatically generated by workflow ${{ github.workflow }}

              Source Repository: [${{ github.repository }}](https://github.com/${{ github.repository }})
              Job URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
              Commit: [${{ github.sha }}](https://github.com/${{ github.repository }}/commits/${{ github.sha }})
    
        - name: Check outputs
          if: ${{ steps.cpr.outputs.pull-request-number }}
          run: |
            echo "Pull Request Number - ${{ steps.cpr.outputs.pull-request-number }}"
            echo "Pull Request URL - ${{ steps.cpr.outputs.pull-request-url }}"
        