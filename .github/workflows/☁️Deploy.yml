name: ‚òÅÔ∏èDeploy

on:
  # workflow_dispatch:
  # workflow_run:
  #   workflows: [üê≥Docker]
  #   types:
  #       - completed
  workflow_call:

jobs:
  flydeploy:
    runs-on: ubuntu-latest
    if: ${{ env.fly_api_token != '' }}
    name: Deploy on deta
    commands:
      - apk update && apk --no-cache add curl git
      - wget -O - https://fly.io/install.sh | sh
      - git clone https://codeberg.org/video-prize-ranch/fly-cfg.git
      - cd fly-cfg/librarian
      - /root/.fly/bin/flyctl deploy --detach
    secrets: [fly_api_token]

  Deta:
    runs-on: ubuntu-latest
    if: ${{ env.DETA_ACCESS_TOKEN != '' }}
    name: Deploy on deta
    steps:
      - name: Checkout
        uses: actions/checkout@v3.5.2
      - name: Deploy to Deta
        uses: BogDAAAMN/deta-deploy-action@v1.0.1
        with:
          deta-access-token: ${{ secrets.DETA_ACCESS_TOKEN }}
          deta-name: ${{ secrets.DETA_STAGING_MICRO_NAME }}
          deta-project: ${{ secrets.DETA_PROJECT_NAME }}

  # Koyeb:
  #   if: ${{ env.DETA_ACCESS_TOKEN != '' }}
  #   name: Deploy on Koyeb
  #   runs-on: ubuntu-latest
  #     uses: koyeb/action-git-deploy@v1
  #     with:
  #       app-name: my-koyeb-app
  #       service-name: my-koyeb-service
  #       service-env: "PORT=8080"
  #       service-ports: "8080:http"
  #       service-routes: "/health:8080"

  Notify:
    if: ${{ env.APPRISE_URL != '' }}
    runs-on: ubuntu-latest
    name: Actions Start Apprise
    steps:
      uses: cstuder/apprise-ga@v3
      with:
        title: "Notication title"
        message: "Message"
      env:
        APPRISE_URL: ${{ secrets.APPRISE_URL }}



